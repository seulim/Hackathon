@using GMKT.GMobile.Web.Models;

@model GiftSendListM

@{
	ViewBag.Title = "G마켓 GIFT CARD";
}
@section css
{
	<link rel="stylesheet" type="text/css" href="@Urls.StyleUrl/320/GiftCard/giftcard.css?v=7"/>
}
	<script type="text/javascript" src="@Urls.ScriptUrl/js/mobile/giftcard.js?ver=1"></script>
	<script type="text/javascript" src="@Urls.ScriptUrl/js/mobile/kakao.link.js?ver=1"></script>
<script type="text/javascript" language="javascript">
	function ItemClick(TokenSeq) {

		var param = "{ ";
		param += "'TOKENSEQ':'" + $.trim(TokenSeq.toString()) + "',";
		param += "'TYPE':'" + $.trim("SEND") + "'}";

		$.ajax({
			type: 'POST',
			url: "/GiftCard/GetItemDetail",
			contentType: "application/json;charset=utf-8",
			data: param,
			async: false,
			success: function (data) {
				ItemViewMake(data);
			},
			error: function (error) {
				alert("Database 검색 실패!");
				return;
			}
		});

	}
	function KakaoSend(TokenSeq) {

		var param = "{ ";
		param += "'TOKENSEQ':'" + $.trim(TokenSeq.toString()) + "' }";

		$.ajax({
			type: 'POST',
			url: "/GiftCard/GetKakaoSendData",
			contentType: "application/json;charset=utf-8",
			data: param,
			async: false,
			success: function (data) {
				executeURLLink(data);
			},
			error: function (error) {
				alert("Kakao Send Data 검색 실패!");
				return;
			}
		});

	}
	function stringnullchange(str) {
		var val = str;
		if (val == null) {
			val = "&nbsp;";
		}

		return val;
	}
	function ItemViewMake(data) {
		$("#listview").text("");
		//상단 바인딩
		//var html = "<div class='gc_total'>";
		var html = "<div class='gc_set_move'>";
		html = html + "<a class='gc_page_prev' href='GiftCardListSend'>리스트로 돌아가기</a>";
		html = html + "</div>";
		html = html + "<ul class='list_giftcard'>";
		html = html + "<li><div>";
		if (data.GiftSend.Price == 5000)
			html = html + "<div class='img'><img src='@Urls.MobileImageUrlV2/640/giftcard/img_gc5000.jpg' alt='' /></div>";
		else if (data.GiftSend.Price == 10000)
			html = html + "<div class='img'><img src='@Urls.MobileImageUrlV2/640/giftcard/img_gc10000.jpg' alt='' /></div>";
		else if (data.GiftSend.Price == 30000)
			html = html + "<div class='img'><img src='@Urls.MobileImageUrlV2/640/giftcard/img_gc30000.jpg' alt='' /></div>";
		else if (data.GiftSend.Price == 50000)
			html = html + "<div class='img'><img src='@Urls.MobileImageUrlV2/640/giftcard/img_gc50000.jpg' alt='' /></div>";
		else if (data.GiftSend.Price == 100000)
			html = html + "<div class='img'><img src='@Urls.MobileImageUrlV2/640/giftcard/img_gc100000.jpg' alt='' /></div>";
		else if (data.GiftSend.Price == 200000)
			html = html + "<div class='img'><img src='@Urls.MobileImageUrlV2/640/giftcard/img_gc200000.jpg' alt='' /></div>";
		html = html + "<div class='cont'>";
		html = html + "<strong class='txt_state type02'>" + data.GiftSend.StatNM + "</strong>";
		html = html + "<ul class='set_info'>";
		html = html + "<li><span class='s_tit'>수신인</span>" + stringnullchange(data.GiftSend.RcvNM) + "</li>";
		//html = html + "<li><span class='s_tit'>취소팝업테스트용</span>" + data.GiftSend.TranswayNM + " <a href='#' class='txt_link' onclick='popCancelResend(\"" + data.GiftSend.TokenSeq + "\",\"" + data.GiftSend.RcvNM + "\");'><span>수신인 번호변경</span></a></li>";
		if (data.GiftSend.TranswayNM == "휴대폰" && data.GiftSend.Stat == "U" && data.GiftSend.rsvTransYN == "N" && data.GiftSend.SuccYN == "N")
			html = html + "<li><span class='s_tit'>발송방법</span>" + data.GiftSend.TranswayNM + " <a href='#' class='txt_link' onclick='popCancelResend(\"" + data.GiftSend.TokenSeq + "\",\"" + data.GiftSend.RcvNM + "\");'><span>수신인 번호변경</span></a></li>";
		else if (data.GiftSend.TranswayNM == "휴대폰" && data.GiftSend.Stat == "N" && data.GiftSend.rsvTransYN == "N" && data.GiftSend.SuccYN == "Y")
			html = html + "<li><span class='s_tit'>발송방법</span>" + data.GiftSend.TranswayNM + " <a href='#' class='txt_link' onclick='popResend(\"" + data.GiftSend.TokenSeq + "\",\"" + data.GiftSend.RcvNM + "\");'><span>재발송</span></a></li>";
		else if (data.GiftSend.TranswayNM == "카카오톡" && data.GiftSend.Stat == "N" && data.GiftSend.MobileRetransCnt == "0")
			html = html + "<li><span class='s_tit'>발송방법</span>" + data.GiftSend.TranswayNM + " <a href='#' class='txt_link' onclick='javascript:KakaoSend(" + data.GiftSend.TokenSeq + ");'><span>친구선택</span></a></li>";
		else if (data.GiftSend.TranswayNM == "카카오톡" && data.GiftSend.Stat == "N" && data.GiftSend.MobileRetransCnt != "0")
			html = html + "<li><span class='s_tit'>발송방법</span>" + data.GiftSend.TranswayNM + " <a href='#' class='txt_link' onclick='javascript:KakaoSend(" + data.GiftSend.TokenSeq + ");'><span>재발송</span></a></li>";
		else
			html = html + "<li><span class='s_tit'>발송방법</span>" + data.GiftSend.TranswayNM + " </li>";
		html = html + "</ul>";
		html = html + "</div>";
		html = html + "</div></li>";
		html = html + "</ul>";
		html = html + "<div class='box_gc_view b_nomarin'>";
		html = html + "<ul>";
		html = html + "<li><span>GIFT CARD 번호</span>" + data.GiftSend.TokenSeq + "</li>";
		if (data.GiftSend.Price == 5000)
			html = html + "<li><span>GIFT CARD 종류</span>5,000원권</li>";
		else if (data.GiftSend.Price == 10000)
			html = html + "<li><span>GIFT CARD 종류</span>10,000원권</li>";
		else if (data.GiftSend.Price == 30000)
			html = html + "<li><span>GIFT CARD 종류</span>30,000원권</li>";
		else if (data.GiftSend.Price == 50000)
			html = html + "<li><span>GIFT CARD 종류</span>50,000원권</li>";
		else if (data.GiftSend.Price == 100000)
			html = html + "<li><span>GIFT CARD 종류</span>100,000원권</li>";
		else if (data.GiftSend.Price == 200000)
			html = html + "<li><span>GIFT CARD 종류</span>200,000원권</li>";
		if (data.GiftSend.TranswayNM == "휴대폰" && data.GiftSend.rsvTransYN == "Y")
			html = html + "<li><span>발송방법</span>" + data.GiftSend.TranswayNM + " <em class='gc_txt_gt01'>예약발송</em></li>";
		else
			html = html + "<li><span>발송방법</span>" + data.GiftSend.TranswayNM + " </li>";
		if (data.GiftSend.TranswayNM == "휴대폰") {
			//html = html + "<li><span>수신인</span>" + data.GiftSend.sendNM + "</li>";
			html = html + "<li><span>휴대폰번호</span>" + data.GiftSend.RcvNM + "</li>";
			html = html + "<li><span>구매일시</span>" + data.GiftSend.BuyDT + "</li>";
			html = html + "<li><span>발송일자</span>" + data.GiftSend.SendDT + " </li>";
			html = html + "<li><span>선물메세지</span>" + data.GiftSend.SendMsg + "</li>";
		}
		else if (data.GiftSend.TranswayNM == "PLASTIC CARD") {
			html = html + "<li><span>수신인</span>" + stringnullchange(data.GiftSend.DelRCVNM) + "</li>";
			html = html + "<li><span>구매일시</span>" + data.GiftSend.BuyDT + "</li>";
			html = html + "<li><span>발송일자</span>" + stringnullchange(data.GiftSend.TransRegDT) + " </li>";
			html = html + "<li><span>배송주소</span>" + stringnullchange(data.GiftSend.DelFrontAddress) + " " + stringnullchange(data.GiftSend.DelBackAddress) + " </li>";
			html = html + "<li><span>연락처</span>" + stringnullchange(data.GiftSend.Telno) + "</li>";
		}
		else if (data.GiftSend.TranswayNM == "G마켓ID") {
			//html = html + "<li><span>발신인</span>" + data.GiftSend.sendNM + "</li>";
			html = html + "<li><span>수신GID</span>" + data.GiftSend.RcvNM + "</li>";
			html = html + "<li><span>구매일시</span>" + data.GiftSend.BuyDT + "</li>";
			html = html + "<li><span>발송일자</span>" + data.GiftSend.SendDT + " </li>";
			html = html + "<li><span>선물메세지</span>" + data.GiftSend.SendMsg + "</li>";
		}
		else if (data.GiftSend.TranswayNM == "카카오톡") {
			html = html + "<li><span>구매일시</span>" + data.GiftSend.BuyDT + "</li>";
			html = html + "<li><span>발송일자</span>" + data.GiftSend.SendDT + " </li>";
		}
		html = html + "</ul>";
		html = html + "</div>";



		jQuery("#listview").append(html);
	}
	function executeURLLink(data) {
		/* 
		msg, url, appid, appname은 실제 서비스에서 사용하는 정보로 업데이트되어야 합니다. 
		*/
		var price = data.GiftKakao.Price;
		price = price.toFixed(0);
		var sendmessage = data.GiftKakao.SenderMemo;
		var authcode = data.GiftKakao.Auth16Code;
		var url = "@Urls.MobileWebUrl" + "/GiftCard/GiftGate?RegCode=" + authcode;

		kakao.link("talk").send({
			//msg: "감사의 마음을 담아 보냅니다.\n상품명 : G마켓 선물권 " + price + "원\n유효기간 : 구매일로부터 5년\n인증번호 : " + authcode + "\n인증하기 : " + url + "\n이용안내 :\n1. G마켓 선물권 > 인증하기에서 인증번호 입력\n2. 선물 받은 금액이 현금잔고로 전환되었는지 확인\n3. 현금잔고로 쇼핑!\n이용문의 : 1566-5701",
			msg: "G마켓 GiftCard가 도착했어요! \n" + sendmessage + "\nG마켓 사이트에서 현금처럼 사용할 수 있는 Gift Card입니다\n" + "-인증번호 : " + authcode + "\n-상품명 : G마켓 Gift Card " + price + "원\n-유효기간 : 구매일로부터 5년\n이용문의 : 1566-5701\n" + "\n이용안내 :\n1. G마켓 홈페이지 > G마켓 Gift Card페이지 > 등록하기에서 인증번호 입력\n(아래 URL을 누르면 바로 이동 가능합니다)\n2. 선물 받은 금액이 현금잔고로 전환되었는지 확인\n3. 현금잔고로 쇼핑하기!\n" + url + "\n(위 URL은 G마켓 App으로 연결 됩니다.)",
			url: "",
			appid: "Mobile.Gmarket.co.kr",
			appver: "2.0",
			appname: "G마켓",
			type: "link"
		});

	}
	function popResend(tokenseq, telno) {
		var custno = "@{@Model.UserCustNo}";
		var telnum = telno;
		var tokensq = tokenseq;

		$("#gc_layer_resend01").text("");
		var html = "<div class='lay_tit'>휴대폰 재발송</div>";
		html = html + "<div class='cont'>";
		html = html + "<p class='s_txt01'>휴대폰 <span class='gc_txt_gt02'>" + telnum + "</span>로<br />재발송 하시겠습니까?</p>";
		html = html + "<p class='s_txt02'>(최대 3회까지 재발송 가능합니다.)</p>";
		html = html + "<div class='gc_set_btn'>";
		html = html + "<a class='gc_btn04' href='#' onclick='javascript:DataResend(\"" + tokensq + "\",\"" + custno + "\",\"" + telnum + "\");'><span>재발송</span></a>";
		html = html + "</div>";
		html = html + "</div>";
		html = html + "<a class='btn_close' href='#' onclick='popPositMid(\"gc_layer_resend01\"); return false;'><span>레이어닫기</span></a>";
		jQuery("#gc_layer_resend01").append(html);

		popPositMid('gc_layer_resend01');
	}
	function DataResend(tokenseq, custno, telno) {
		var param = [
				{ name: 'ticketNo', value: tokenseq }
				];
		$.ajax({
			type: 'POST',
			dataType: "json",
			url: "/GiftCard/GiftCardDetailViewListResend",
			data: param,
			async: false,
			success: function (result) {
				if (result != null && result.length != "0") {
					if (result.RetCode == -101 || result.RetCode == -102) { //1~2회 오류 입력 시
						alert("사용할 수 없는 인증번호 입니다\n확인 후 다시 입력해 주세요.");
					}
					else if (result.RetCode == 3) {
						alert("재발송은 3회까지 가능합니다. 재발송이 3회 이상 초과하였습니다.");
						popPositMid('gc_layer_resend01');
					}
					else {
						if (confirm("GiftCard 인증코드 재발송이 완료 되었습니다.")) {
							parent.location.href = "/GiftCard/GiftCard";
						}
					}
				}
				else {
					alert("GiftCard 인증코드 재발송 중 오류가 발생했습니다. 다시 한번 시도해 주시기 바랍니다.");
				}
			},
			error: function (error) {
				alert("GiftCard 인증코드 재발송 중 오류가 발생했습니다. 에러." + error.toString());
			}
		});
	}
	function popCancelResend(tokenseq, telno) {
		var custno = "@{@Model.UserCustNo}";
		var telnum = telno;
		var tokensq = tokenseq;
		var isiphone = "@{@PageAttr.IsIphoneApp}";
		var isandroid = "@{@PageAttr.IsAndroidApp}";

		$("#gc_layer_chg_number").text("");
		var html = "<div class='lay_tit'>휴대폰 수신인 번호변경</div>";
		html = html + "<div class='cont'>";
		html = html + "<div class='box_new_nm'>";
		html = html + "<span>신규번호</span>";
		html = html + "<input type='number' id='phoneNumber1' class='gc_text' maxlength='11' onblur='javascript:NumFocusOut(this);' onkeyup='javascript:NumText(this);' />";
		if (isiphone == "True" || isandroid == "True")
			html = html + "<a class='gc_btn01' href='#' onclick='javascript:openPhoneAddress(1);'><span>폰주소록</span></a>";
		html = html + "</div>";
		html = html + "<div class='gc_set_btn'>";
		html = html + "<a class='gc_btn04' href='#' onclick='javascript:DataCancelResend(\"" + tokensq + "\",\"" + custno + "\",\"" + telnum + "\");'><span>번호변경 발송</span></a>";
		html = html + "</div>";
		html = html + "</div>";
		html = html + "<a class='btn_close' href='#' onclick='popPositMid(\"gc_layer_chg_number\"); return false;'><span>레이어닫기</span></a>";
		jQuery("#gc_layer_chg_number").append(html);

		popPositMid('gc_layer_chg_number');
	}
	function DataCancelResend(tokenseq, custno, telno) {
		var Retelno = document.GiftCardOrder.phoneNumber1.value;
		var param = [
				{ name: 'ticketNo', value: tokenseq }, { name: 'telNo', value: Retelno }
				];
		$.ajax({
			type: 'POST',
			dataType: "json",
			url: "/GiftCard/GiftCardCancelResend",
			data: param,
			async: false,
			success: function (result) {
				if (result != null && result.length != "0") {
					if (result.RetCode == -100) { //1~2회 오류 입력 시
						alert("GiftCard 인증코드 재발송 데이터 업데이트중 오류가 발생했습니다. 다시 한번 시도해 주시기 바랍니다.");
					}
					else if (result.RetCode == 10) {
						if (confirm("GiftCard 인증코드 재발송이 완료 되었습니다.")) {
							parent.location.href = "/GiftCard/GiftCard";
						}
					}
					//					else {
					//						if (confirm("선물권 인증코드 재발송이 완료 되었습니다.")) {
					//							parent.location.href = "/GiftCard/GiftCard";
					//						}
					//					}
				}
				else {
					alert("GiftCard 인증코드 재발송 데이터 업데이트중 오류가 발생했습니다. 다시 한번 시도해 주시기 바랍니다.");
				}
			},
			error: function (error) {
				alert("GiftCard 인증코드 재발송 데이터 업데이트중 오류가 발생했습니다. 에러.");
			}
		});
	}
	function moreClick() {
		var nowpagecnt = parseInt(document.GiftCardOrder.nowpagecnt.value);
		var totalpagecnt = parseInt(document.GiftCardOrder.totalpagecnt.value);
		var totalrownum = parseInt(document.GiftCardOrder.totalrownum.value);
		if (nowpagecnt == totalpagecnt) {
			alert("끝 페이지 입니다.");
			return false;
		}
		else {
			$("#listsend" + nowpagecnt.toString() + "").show();

			var showrowcnt = (nowpagecnt + 1) * 10;
			if (totalrownum > showrowcnt) {
				document.getElementById("btnmore").innerHTML = "<span><span>더보기</span> ( <span>" + showrowcnt.toString() + "</span>/" + totalrownum + ")</span>";
			}
			else {
				document.getElementById("btnmore").innerHTML = "<span><span>더보기</span> ( <span>" + totalrownum.toString() + "</span>/" + totalrownum + ")</span>";
			}
			document.GiftCardOrder.nowpagecnt.value = (nowpagecnt + 1).toString();
		}
	}
	function optionchange() {
		var optval = document.GiftCardOrder.monthselect.value;
		document.GiftCardOrder.shmonth.value = optval.toString();
		document.GiftCardOrder.action = "GiftCardListSend";
		document.GiftCardOrder.submit();
	}
	function rowadd(stat) {
		document.GiftCardOrder.totalrownum.value = stat.toString();
	}
	function totaladd(stat) {
		//var rowcnt = parseInt(document.GiftCardOrder.totalpagecnt.value);
		//rowcnt = rowcnt + 1;
		document.GiftCardOrder.totalpagecnt.value = stat.toString();
	}
	function openPhoneAddress(id) {
		location.href = "gmarket://msgAppPresent?kind=address&id=" + id;
	}

	function setPhoneNumber(phoneNum, id) {
		document.getElementById('phoneNumber' + id).value = phoneNum;
	}
	function NumFocusOut(obj) {
		var objEv = event.srcElement;
		var val = obj.value;
		var numcheck = val.substr(0, 2);

		if (numcheck != "01") {
			alert("올바른 핸드폰 번호가 아닙니다.");
			objEv.value = "";
			return false;
		} else {
			if (val.length < 10 || val.length > 11) {
				alert("올바른 핸드폰 번호가 아닙니다.");
				objEv.value = "";
				return false;
			}
			return true;
		}
	}
	function NumText(obj) {
		var objEv = event.srcElement;
		var numPattern = /([^0-9|])/;
		numPattern = objEv.value.match(numPattern);
		if (numPattern != null) {
			alert("숫자만 입력해 주세요!");
			objEv.value = "";
			objEv.focus();
			return false;
		} else {
			return true;
		}
	}
	$(document).ready(function () {
		displayLayer("progress_icon", "none");

		if ("@{@PageAttr.IsLogin}" == "True") {
		}
		else {
			document.location.href = "@Urls.LoginUrl";
		}
		//popPositMid('gc_layer_regist02');	
		//listmake();
		document.GiftCardOrder.monthselect.value = document.GiftCardOrder.shmonth.value;

	});
	</script>

@{Html.BeginForm("", "", FormMethod.Post, new { name = "GiftCardOrder", id = "GiftCardOrder" });}
<!-- CONTENT -->
<div id="content" class="ctns">
	<div class="gc_location">
		<span><a href="GiftCard" style="color:White;" >GIFT CARD</a></span>
		<span>확인/재발송</span>
	</div>
	<ul class="gc_tab03">
		<li class="on"><a href="GiftCardListSend"><span>보낸선물</span></a></li>
		<li><a href="GiftCardListRsv"><span>받은선물</span></a></li>
	</ul>
@if (PageAttr.IsLogin == true)
{
		<!--	잘라서 새로 그릴 영역	-->
		@:<div id="listview">
		@:<div class="gc_total">
	if (Model.GiftSend.Count > 0)
	{
			@:<div class="s_tit">전체 <strong class="gc_txt_gt01">@Model.GiftSend.Count</strong>건</div>
	}
	else
	{
			@:<div class="s_tit">전체 <strong class="gc_txt_gt01">0</strong>건</div>
	}
			@:<div class="r_cont">
				@:<span class="txt01">최근</span>
				@:<div class="gc_sel01">
				@:<select id="monthselect" onchange="javascript:optionchange();">
					@:<option value="1">1개월</option>
					@:<option value="3">3개월</option>
					@:<option value="6">6개월</option>
					@:<option value="12">12개월</option>
					@:<option value="24">24개월</option>
				@:</select>
				@:</div>
			@:</div>
		@:</div>
	@*if (true)
	{
		string[] buydt = Model.GiftSend[0].BuyDT.ToString().Split(' ');
		@:<div class="gc_box_date">@buydt[0]</div>
	}*@
	if (Model.GiftSend.Count > 0)
	{
		int totalcount = Convert.ToInt32(Model.GiftSend.Count);
		int pagecount = totalcount / 10;
		if ((totalcount % 10) > 0)
		{
			pagecount = pagecount + 1;
		}
		int allcnt = 0;
		string nowdt = "";
		for (int i = 0; i < pagecount; i++)
		{
			string listid = "listsend" + i.ToString();
			if (i == 0)
			{
				@:<div id="@listid">
			}
			else
			{
				@:<div id="@listid" style="display:none;">
			}
			if (totalcount > 10)
			{
				for (var j = 0; j < 10; j++)
				{
					//@:<li>
					string[] buydt = Model.GiftSend[allcnt].BuyDT.ToString().Split(' ');
					if (nowdt != buydt[0])
					{
						@:<div class="gc_box_date">@buydt[0]</div>
						nowdt = buydt[0];
					}
					@:<ul class="list_giftcard">
					@:<li>
					if (string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()))
					{
						@:<a href="javascript:void(0);" >
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()))
					{
						@:<a href="javascript:void(0);" onclick="javascript:alert('GiftCard 생성 중입니다. GiftCard의 상세 내용은 잠시 후에 다시 확인해 주세요.');">
					}
					else
					{
						@:<a href="javascript:void(0);" onclick="javascript:ItemClick('@Model.GiftSend[allcnt].TokenSeq');">
					}
					if (Model.GiftSend[allcnt].Price == 5000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc5000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 10000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc10000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 30000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc30000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 50000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc50000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 100000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc100000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 200000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc200000.jpg" alt="" /></div>
					}
					@:<div class="cont">
					@:<strong class="txt_state type02">@Model.GiftSend[allcnt].StatNM</strong>
					@:<ul class="set_info">
					@:<li><span class="s_tit">수신인</span>@Model.GiftSend[allcnt].RcvNM</li>
					if (Model.GiftSend[allcnt].TranswayNM == "휴대폰" && Model.GiftSend[allcnt].StatNM == "선물취소")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="popCancelResend('@Model.GiftSend[allcnt].TokenSeq','@Model.GiftSend[allcnt].RcvNM');" ><span>수신인 번호변경</span></span></li>
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "휴대폰" && Model.GiftSend[allcnt].StatNM == "선물완료")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="popResend('@Model.GiftSend[allcnt].TokenSeq','@Model.GiftSend[allcnt].RcvNM');" ><span>재발송</span></span></li>
					}
					//테스트
					//else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && !string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()) && Model.GiftSend[allcnt].MobileRetransCnt == "0")
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()))
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM 대기<br />친구 선택은 잠시 후 진행해 주세요.</li>
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && Model.GiftSend[allcnt].StatNM == "전송대기" && !string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()) && Model.GiftSend[allcnt].MobileRetransCnt == "0")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="javascript:KakaoSend('@Model.GiftSend[allcnt].TokenSeq');" ><span>친구선택</span></span></li>
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && Model.GiftSend[allcnt].StatNM == "선물완료" && !string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()) && Model.GiftSend[allcnt].MobileRetransCnt != "0")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="javascript:KakaoSend('@Model.GiftSend[allcnt].TokenSeq');" ><span>재발송</span></span></li>
					}
					else
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" ></span></li>
					}
					@:</ul>
					@:</div>
					@:</a>				
					@:</li>
					@:</ul>
					allcnt = allcnt + 1;
				}
				totalcount = totalcount - 10;
			}
			else
			{
				for (int j = 0; j < totalcount; j++)
				{
					//@:<li>
					string[] buydt = Model.GiftSend[allcnt].BuyDT.ToString().Split(' ');
					if (nowdt != buydt[0])
					{
						@:<div class="gc_box_date">@buydt[0]</div>
						nowdt = buydt[0];
					}
					@:<ul class="list_giftcard">
					@:<li>
					if (string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()))
					{
						@:<a href="javascript:void(0);" >
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()))
					{
						@:<a href="javascript:void(0);" onclick="javascript:alert('GiftCard 생성 중입니다. GiftCard의 상세 내용은 잠시 후에 다시 확인해 주세요.');">
					}
					else
					{
						@:<a href="javascript:void(0);" onclick="javascript:ItemClick('@Model.GiftSend[allcnt].TokenSeq');">
					}
					if (Model.GiftSend[allcnt].Price == 5000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc5000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 10000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc10000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 30000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc30000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 50000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc50000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 100000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc100000.jpg" alt="" /></div>
					}
					else if (Model.GiftSend[allcnt].Price == 200000)
					{
						@:<div class="img"><img src="@Urls.MobileImageUrlV2/640/giftcard/img_gc200000.jpg" alt="" /></div>
					}
					@:<div class="cont">
					@:<strong class="txt_state type02">@Model.GiftSend[allcnt].StatNM</strong>
					@:<ul class="set_info">
					@:<li><span class="s_tit">수신인</span>@Model.GiftSend[allcnt].RcvNM</li>
					if (Model.GiftSend[allcnt].TranswayNM == "휴대폰" && Model.GiftSend[allcnt].StatNM == "선물취소")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="popCancelResend('@Model.GiftSend[allcnt].TokenSeq','@Model.GiftSend[allcnt].RcvNM');" ><span>수신인 번호변경</span></span></li>
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "휴대폰" && Model.GiftSend[allcnt].StatNM == "선물완료")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="popResend('@Model.GiftSend[allcnt].TokenSeq','@Model.GiftSend[allcnt].RcvNM');" ><span>재발송</span></span></li>
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()))
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM 대기<br />친구 선택은 잠시 후 진행해 주세요.</li>
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && Model.GiftSend[allcnt].StatNM == "전송대기" && !string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()) && Model.GiftSend[allcnt].MobileRetransCnt == "0")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="javascript:KakaoSend('@Model.GiftSend[allcnt].TokenSeq');" ><span>친구선택</span></span></li>
					}
					else if (Model.GiftSend[allcnt].TranswayNM == "카카오톡" && Model.GiftSend[allcnt].StatNM == "선물완료" && !string.IsNullOrEmpty(Model.GiftSend[allcnt].TokenSeq.ToString()) && Model.GiftSend[allcnt].MobileRetransCnt != "0")
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" onclick="javascript:KakaoSend('@Model.GiftSend[allcnt].TokenSeq');" ><span>재발송</span></span></li>
					}
					else
					{
						@:<li><span class="s_tit">발송방법</span>@Model.GiftSend[allcnt].TranswayNM <span class="txt_link" ></span></li>
					}
					@:</ul>
					@:</div>
					@:</a></li>
					@:</ul>
					allcnt = allcnt + 1;
				}
			}
			//@:</ul>
			@:</div>
		}
		if (pagecount > 1)
		{
			@:<a class="gc_btn_more b_nomarin" id="btnmore" href="javascript:void(0);" onclick="javascript:moreClick();"><span><span>더보기</span> ( <span>10</span>/@Model.GiftSend.Count)</span></a>
		}
		@:<input type='hidden' id='totalrownum' name='totalrownum' value='@Model.GiftSend.Count' />
		@:<input type='hidden' id='totalpagecnt' name='totalpagecnt' value='@pagecount' />
	}
	else
	{
		@:<div class="gc_noresult">
			@:<div class="cont">
				@:<p class="txt01">아직 보낸 선물이 없습니다!</p>
				@:<p class="txt02">고마운 분들께 G마켓 Gift card를 보내 보세요.</p>
				@:<div class="gc_set_btn">
				@:<a class="gc_btn03" href="GiftCard"><span>선물하러 가기</span></a>
				@:</div>
			@:</div>
		@:</div>
	}
}
	</div>
	<!--	잘라서 새로 그릴 영역	-->

	<!-- 휴대폰 재발송 레이어 -->
	<div id="gc_layer_resend01" class="gc_layer gc_lay_resend">
		<div class="lay_tit">휴대폰 재발송</div>
		<div class="cont">
			<p class="s_txt01">휴대폰 <span class="gc_txt_gt02">010-9703-1107</span>로<br />재발송 하시겠습니까?</p>
			<p class="s_txt02">(최대 3회까지 재발송 가능합니다.)</p>
			<div class="gc_set_btn">
				<a class="gc_btn04" href="#"><span>재발송</span></a>
			</div>
		</div>
		<a class="btn_close" href="#" onclick="popPositMid('gc_layer_resend01'); return false;"><span>레이어닫기</span></a>
	</div>
	<!-- //휴대폰 재발송 레이어 -->
		
	<!-- 휴대폰 수신인 번호변경 레이어 -->
	<div id="gc_layer_chg_number" class="gc_layer gc_lay_chg_number">
		<div class="lay_tit">휴대폰 수신인 번호변경</div>
		<div class="cont">
			<div class="box_new_nm">
				<span>신규번호</span>
				<input type="number" id="phoneNumber1" maxlength="11" onblur="javascript:NumFocusOut(this);" onkeyup="javascript:NumText(this);" class="gc_text" />
				@if (PageAttr.IsIphoneApp == true || PageAttr.IsAndroidApp == true)
		{
					@:<a class="gc_btn01" href="#" onclick="javascript:openPhoneAddress(1);"><span>폰주소록</span></a>
				}
			</div>
			<div class="gc_set_btn">
				<a class="gc_btn04" href="#"><span>번호변경 발송</span></a>
			</div>
		</div>
		<a class="btn_close" href="#" onclick="popPositMid('gc_layer_chg_number'); return false;"><span>레이어닫기</span></a>
	</div>
	<!-- //휴대폰 수신인 번호변경 레이어 -->		
</div>
<!-- //CONTENT -->
@*@section css
{
	<link rel="stylesheet" type="text/css" href="@Urls.StyleUrl/320/GiftCard/giftcard.css?v=7"/>
}

@section scripts
{
	<script type="text/javascript" src="@Urls.ScriptUrl/js/mobile/giftcard.js?ver=1"></script>
	<script type="text/javascript">
		window.onload = function () {
			setTimeout(function () {
				window.scrollTo(0, 1)
			}, 100);
		}
		//		$(document).ready(function () {
		//			gc_msg_sel();
		//			gc_terms();
		//		});
	</script>
}*@
<input type='hidden' id='nowpagecnt' name='nowpagecnt' value='1' />
<input type='hidden' id='shmonth' name='shmonth' value='@Model.OptionValue' />
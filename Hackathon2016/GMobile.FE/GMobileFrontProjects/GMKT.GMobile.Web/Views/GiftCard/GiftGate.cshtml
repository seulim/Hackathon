@using GMKT.GMobile.Web.Models;

@model TokenGateM

@{
	ViewBag.Title = "G마켓 GIFT CARD";

	string storeURL = "";
	string appScheamHeader = "GiftCardRegist";
	
	if (PageAttr.IsIphone)
	{
		storeURL = "http://itunes.apple.com/kr/app/gmarket/id340330132?mt=8";
		appScheamHeader = "GiftCardRegist";
	}
	else if (PageAttr.IsAndroid)
	{
		storeURL = "market://market.android.com/details?id=com.ebay.kr.gmarket";
		appScheamHeader = "GiftCardRegist";
	}

	string appScheme = "gmarket://GiftCardRegist?RegCode=" + Model.RegistCode;

	string appSchemeForLatestAndroid = "Intent://GiftCardRegist?RegCode=" + Model.RegistCode +
		"#Intent;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;scheme=gmarket;package=com.ebay.kr.gmarket;end";
}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ko" xml:lang="ko">
<head>
	<meta http-equiv="content-Type" content="text/html; charset=utf-8" /> 
	<title>test appstore</title>
	@*<link rel="stylesheet" type="text/css" href="@Urls.StyleUrl/320/GiftCard/common_2013.css" /><!--20140416추가 ahana05-->*@
	<script type="text/javascript" src="@Urls.ScriptUrl/js/mobile/main/common/jquery-1.7.1.min.js"></script>
</head>
	<body>
	<!-- CONTENTS --><!--20140416추가 ahana05-->
	<div id="contents" class="cts">
		

		<div class="connecting_wp" style="padding:44px 10px 45px;text-align:center;">
			<img src="@Urls.MobileImageUrlV2/640/giftcard/connecting.png" alt="로딩중" class="img_loading" style="width:106px;" />
			<p class="txt01" style="color:#000;font-weight:normal;letter-spacing:-1px;font-size:1.31em;margin:12px 0 5px;">G마켓 앱으로 연결중입니다.</p>
			<p class="txt02" style="color:#000;font-weight:normal;letter-spacing:-1px;font-size:1em;">잠시만 기다려주세요.</p>
		</div>


	</div>
	<!--// CONTENTS --><!--20140416추가 ahana05-->

	<iframe id="checkframe" name="checkframe" width="0" height="0" style="display:none;"></iframe>
	<script type="text/javascript">
		var appSchemeForLatestAndroid = "@appSchemeForLatestAndroid";

		var ua = navigator.userAgent.toLowerCase();
		var isAndroid = ua.indexOf("android") > -1;

		var isIphone = @(PageAttr.IsIphone ? "true":"false");

		function getAndroidVersion() {
			var androidVersion = -1; // def value, for non-Android devices
			var ua = navigator.userAgent.toLowerCase();
			var androidIndex = ua.indexOf('android');

			if (androidIndex != -1) {
				var versionStartIndex = androidIndex + 8;
				var versionEndIndex = ua.indexOf(';', versionStartIndex);

				androidVersion = parseFloat(ua.slice(versionStartIndex, versionEndIndex));
			}

			return androidVersion;
		}

		function checkApplicationInstall() {

		if ( isIphone ){			//아이폰 앱이 아직 구축되지 않아 아이폰만 우회.
			window.location.href = "@Urls.MobileWebUrl" + "/GiftCard/GiftCardRegist?RegCode=" + "@Model.RegistCode";
		}
		else{	
				document.checkframe.location = "@appScheme";
				setTimeout("checkApplicationInstall_callback()", 500);
		}

		}

		function checkApplicationInstall_callback() {
			try {
				
				if ( isIphone )
					document.location = '@storeURL';
				else
					var s = document.checkframe.document.body.innerHTML;

			} catch (e) {

				$.browser.chrome = /chrom(e|ium)/.test(navigator.userAgent.toLowerCase()); 

				if ( $.browser.chrome /*&& getAndroidVersion() >= 4.3*/) {
					window.location.href = appSchemeForLatestAndroid;
				}
				else if ( isAndroid )
				{
					window.location.href = '@storeURL';
				}
				else if ( isIphone ){
					document.location = '@storeURL';
				}
				else
				{
					alert('지원하지 않는 단말기입니다.');
				}
			}
		}

		$(document).ready(function () {
			checkApplicationInstall();
		});
	</script>
	</body>
</html>
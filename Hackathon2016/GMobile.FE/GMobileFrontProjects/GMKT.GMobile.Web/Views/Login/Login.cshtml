@using GMKT.GMobile.Constant;
@using GMobile.Data.Tiger;
@using GMobile.Data.DisplayDB;
@using GMobile.Data.Diver;

@model GMKT.GMobile.Web.Models.LoginM

@{
	string fromWhere = Model.FromWhere;
	string signUpUrl = Urls.MobileWebUrlSecure + "/SignUp" + (String.IsNullOrEmpty(fromWhere) == true ? "" : "?fromWhere=" + fromWhere);	
}

<script type="text/javascript" src="@Urls.ScriptUrl/js/mobile/member/Login.js"></script>
<script type="text/javascript">
	document.domain = "gmarket.co.kr";
	$(document).ready(function () {
		if ($('#n_mem_rdo').is(':checked')) {
			$('#n_mem_rdo').trigger('click');
			$('#nuserId').focus();
		}
		else {
			$('#id').focus()
		}
	});

    function checkValid(form) {

        // 브라우저가 쿠키사용을 허용하고 있는지 체크하는 루틴 2016.08.03
        {
            var cookieName = 'testCookie' + (new Date().getTime());
            document.cookie = cookieName + '=cookieValue';
            var cookiesEnabled = document.cookie.indexOf(cookieName) != -1;
            if (cookiesEnabled) {
	            expires = new Date(new Date().getTime() + 1000 * 60 * 60 * 24 * -1);
	            document.cookie = cookieName + '=; expires='+expires+';';
            }
            else {
                alert("죄송합니다. 로그인에 실패했습니다.\n\n현재 사용중이신 브라우저가 쿠키 사용안함으로 설정되어 있습니다.\n설정 메뉴에서 쿠키 '사용함'으로 변경 후 다시 시도해주세요.");
                return false;
            }
        }

		if ($('#n_mem_rdo').is(':checked')) {
			if (!trim(document.defaultForm.nuserId.value)) {
				alert("주문자명를 입력해 주세요.");
				document.defaultForm.nuserId.focus();
				return ;
			}

			if (!trim(document.defaultForm.nuserPn.value) || !trim(document.defaultForm.nuserPn2.value) || !trim(document.defaultForm.nuserPn3.value)) {
				alert("휴대폰 번호를 입력해 주세요.");

				if(trim(document.defaultForm.nuserPn.value))
					document.defaultForm.nuserPn.focus();
				else if (trim(document.defaultForm.nuserPn2.value))
					document.defaultForm.nuserPn2.focus();
				else if (trim(document.defaultForm.nuserPn3.value))
					document.defaultForm.nuserPn3.focus();

				return false;
			}

			if (!trim(document.defaultForm.nuserPw.value)) {
				alert("주문비밀번호를 입력해 주세요.");
				document.defaultForm.nuserPw.focus();
				return;
			}

			document.defaultForm.action = "@Urls.MobileWebUrlSecure/Login/LoginForNonMember";
		}
		else {
			if ((document.defaultForm.id.value == "") || trim(document.defaultForm.id.value) == "") {
				alert("아이디를 입력해 주세요.");
				document.defaultForm.id.focus();
				return;
			}

			if (getByteLength(document.defaultForm.id.value) > 10) {
				alert("아이디 확인 후 다시 입력해 주세요.");
				document.defaultForm.id.focus();
				return;
			}

			if ((document.defaultForm.pwd.value == "") || trim(document.defaultForm.pwd.value) == "") {
				alert("비밀번호를 입력해 주세요.");
				document.defaultForm.pwd.focus();
				return;
			}

			if (getByteLength(document.defaultForm.pwd.value) > 15) {
				alert("비밀번호는 15자리까지만 입력해주세요.");
				document.defaultForm.pwd.focus();
				return;
			}
			document.defaultForm.action = "@Urls.MobileWebUrlSecure/Login/Login";
		}
		document.defaultForm.submit();
	}

	var onDirect = function () {
		document.defaultForm.action = "@Urls.MobileWebUrlSecure/Login/LoginForNonMemberOrder";
		document.defaultForm.submit();
	}

	var setSendMethod = function (value) {
		$("#nSendMethod").val(value);
	}

	var findOrderPwd = function (form) {
		//validate user input
		var custName = form.nuserId2.value;
		var phoneNo = form.nsearchPn.value + "-" + form.nsearchPn2.value + "-" + form.nsearchPn3.value;
		var packNo = form.nuserCart.value;
		var sendMethod = form.nSendMethod.value;

		if (custName == "") {
			alert("이름을 입력해 주세요.");
			form.nuserId2.focus();
			return false;
		}

		if (sendMethod == "1") {
			if (form.nsearchPn.value == "") {
				alert("휴대폰번호를 입력해 주세요.");
				form.nsearchPn.focus();
				return false;
			}

			if (form.nsearchPn2.value == "") {
				alert("휴대폰번호를 입력해 주세요.");
				form.nsearchPn2.focus();
				return false;
			}


			if (form.nsearchPn3.value == "") {
				alert("휴대폰번호를 입력해 주세요.");
				form.nsearchP3.focus();
				return false;
			}
		}

		if (packNo == "") {
			alert("장바구니번호를 입력해 주세요.");
			form.nuserCart.focus();
			return false;
		}

		//ajax
		$.ajax({
			url: "@Urls.MobileWebUrlSecure/Login/ResetNonMemberOrderPassword",
			type: "GET",
			dataType: "jsonp",
			data: {
				custName: custName,
				phoneNo: phoneNo,
				packNo: packNo,
				sendMethod: sendMethod
			},
			success: function (result) {
				if (result) {
					//TODO by sue : test해보고 고칠 예정
					alert(result.ResultDescription);
				}
			},
			error: function (result) {
				//TODO by sue : test해보고 고칠 예정
				console.log("resetPW Error : ", arguments);
			}
		});

		return false;
	}
</script>

@section css
{
	<link rel="stylesheet" type="text/css" href="@Urls.ScriptUrl/mobile/css/etc.css" />
}

<!-- UI WRAPPER -->
<div class="wrap" selected="true">
	<!-- CONTENTS -->
	<div id="contents" class="cts">		
		<div class="mhgroup">
			<h3>로그인</h3>
		</div>

		<!-- LOGIN -->
		<div class="login">
				
	@if (Model.IsAdultLogin)
	{
			<div class="notice_adult">
				<div class="adult">
					<img src="@Urls.MobileImageUrl/480/adult_img_118.png" alt="19" />
					<p class="txt">
						본 상품은 청소년 유해매체물로서 19세 미만의 청소년이 이용할 수 없습니다. 이용을 원하시면 (청소년보호법에 따라) 나이 및 본인 여부를 확인해	주시기 바랍니다.
					</p>
				</div>
			</div>
	}
			<form name="defaultForm" id="defaultForm" method="post" onsubmit="return checkValid(this)">
				<input type="hidden" name="url" value="@Model.ReturnUrl" />
				<input type="hidden" name="fromWhere" value="@Model.FromWhere" />
				<fieldset>
					<legend>로그인</legend>
					@if(String.IsNullOrEmpty(ViewBag.Type))
					{
					<div class="login_tab">
						<span><input type="radio" id="mem_rdo" name="mem_rod_ck" checked="checked"><label for="mem_rdo">회원</label></span>
						<span><input type="radio" id="n_mem_rdo" name="mem_rod_ck"><label for="n_mem_rdo">비회원</label></span>
					</div>
					}
					<div class="at_log mem">
						<dl>
							<dt class="uid"><label for="userId">아이디</label></dt>
							<dd><input type="text" name="id" id="id" title="아이디 입력" tabindex="1" value="" maxlength="10" /></dd>
							<dt class="upw"><label for="userPw">비밀번호</label></dt>
							<dd><input type="password" name="pwd" id="pwd" title="비밀번호 입력" tabindex="2"  maxlength="15" /></dd>
						</dl>
						<button type="submit" title="login" class="lgs" onclick="javascript:checkValid(document.defaultForm); return false;">
							<span>로그인</span>
						</button>                   
	@if (Model.IsMobileBrowser || PageAttr.IsApp)
	{
						<p class="isv">
							<input type="checkbox" id="autoLogin" name="autoLogin" value="true" checked="">
							<label for="autoLogin">자동로그인</label>
		@if(PageAttr.IsApp)
		{
							<input type="checkbox" id="push_agree" name="push_agree" value="true" checked="">
							<label for="push_agree">알림 받기</label>
		}
						</p>
	}
						<div class="lgb">
							<div class="btnbx_sch">
								<a href="@signUpUrl" class="btn_sch join"><span>회원가입</span></a>
								<a href="@Urls.MemberSignInRootSecure/Mobile/IDPW?type=id" class="btn_sch"><span>아이디 찾기</span></a>
								<a href="@Urls.MemberSignInRootSecure/Mobile/IDPW?type=pw" class="btn_sch pw"><span>비밀번호 찾기</span></a>
							</div>
						</div>
						@if(ViewBag.Type == "direct")
						{
						<div class="lgb_nm">
							<p class="txt">회원가입이나 로그인 없이도  주문 가능 합니다. </p>
							<button type="submit" title="login" class="lgs" onclick="javascript:onDirect(); return false;"><span>비회원<br>구매하기</span></button>
						</div>
						}
					</div>
					<div class="at_log nm" style="display: none">
						<dl>
							<dt class="nuid">
								<label for="nuserId">주문자명</label></dt>
							<dd>
								<input type="text" name="nuserId" id="nuserId" title="주문자명 입력" maxlength="50" /></dd>
							<dt class="nupn">
								<label for="nuserPn">휴대폰번호</label></dt>
							<dd class="inp_pn">
								<input type="text" onkeypress='return event.charCode >= 48 && event.charCode <= 57' name="nuserPn" id="nuserPn" maxlength="3" title="휴대폰번호 앞자리 입력" />
								<input type="text" onkeypress='return event.charCode >= 48 && event.charCode <= 57' name="nuserPn2" id="nuserPn2" maxlength="4" title="휴대폰번호 중간자리 입력" />
								<input type="text" onkeypress='return event.charCode >= 48 && event.charCode <= 57' name="nuserPn3" id="nuserPn3" maxlength="4" title="휴대폰번호 뒷자리 입력" />
							</dd>
							<dt class="nupw">
								<label for="nuserPw">주문비밀번호</label></dt>
							<dd>
								<input type="password" maxlength="10" name="nuserPw" id="nuserPw" title="주문비밀번호 입력" /></dd>
						</dl>
						<button type="submit" title="login" class="lgs" onclick="javascript:checkValid(document.defaultForm); return false;">
							<span>주문내역<br>조회하기</span>
						</button>
						<button type="button" onclick="popBlockUI3('ly_delvpw');return false;" class="pwsp">주문비밀번호 찾기</button>
						<p class="noti">
							주문 시 입력한 주문자 명과 휴대폰 번호,
							<br>
							주문 비밀번호를 정확히 입력해주세요.</p>
					</div>
				</fieldset>
			</form>	
		</div>
		<!--// LOGIN -->
		<!-- [D] 주문비밀번호 찾기 레이어 -->
		<form name="orderPwdFindForm" id="orderPwdFindForm" method="post" onsubmit="return findOrderPwd(this)">
			<div class="ly_delv_pw" id="ly_delvpw" style="display: none;">
				<div class="lay_wp">
					<h3>비회원 주문비밀번호 찾기</h3>
					<p class="ly_txt">주문시 입력한 이메일주소 또는 휴대폰번호로 <br />임시 비밀번호를 보내드립니다.</p>
					<div class="at_log nm">
						<div class="line nuid">
							<label for="nuserId2">주문자 명</label><input type="text" name="id" id="nuserId2" title="주문자명 입력">
						</div>
						<div class="line nupn">
							<label for="nsearchPn">휴대폰 번호</label>
							<p class="inp_tel">
								<input type="tel" onkeypress='return event.charCode >= 48 && event.charCode <= 57' name="pn" id="nsearchPn" maxlength="3" title="휴대폰번호 앞자리 입력" pattern="[0-9]*" class="fst_tel" /><span> - </span>
								<input type="tel" onkeypress='return event.charCode >= 48 && event.charCode <= 57' name="pn" id="nsearchPn2" maxlength="4" title="휴대폰번호 중간자리 입력" pattern="[0-9]*" class="mid_tel" /><span> - </span>
								<input type="tel" onkeypress='return event.charCode >= 48 && event.charCode <= 57' name="pn" id="nsearchPn3" maxlength="4" title="휴대폰번호 뒷자리 입력" pattern="[0-9]*" class="lst_tel" />
							</p>
						</div>
						<div class="line nupw">
							<label for="nuserCart">장바구니번호</label>
							<input type="number" name="pcart" id="nuserCart" title="장바구니번호" placeholder="주문확인 이메일에서 확인 가능" pattern="[0-9]*" />
						</div>
						<div class="ly_btn">
							<input type="hidden" name="nSendMethod" id="nSendMethod" />
							<button type="submit" title="email" class="lgs" onclick="setSendMethod(0);"><span>이메일로 받기</span></button>
							<button type="submit" title="sms" class="lgs" onclick="setSendMethod(1);"><span>휴대폰 문자로 받기</span></button>
						</div>						
					</div>
					<p class="cs_tel">확인이 어려운 경우 고객센터 <a href="tel:1566-5701">1566-5701</a>로 문의주세요.</p>
					<a href="#" class="lay_clse" onclick="popBlockUI('ly_delvpw');return false;">닫기</a>			
				</div>
			</div>
		</form>
	</div>
	<!-- /CONTENTS -->
</div>
<!-- //UI WRAPPER -->

@section scriptfiles
{
<script type="text/javascript" src="@Urls.ScriptUrl/js/mobile/main/common/jquery.lazyload.min.js"></script>
<script type="text/javascript" src="@Urls.ScriptUrl/js/mobile/main/module/ebayModule/ebayModule-v0.0.5.js"></script>
}

@section iframes
{
<form id="MainWiseLogForm" name="MainWiseLogForm" method="post">
	<iframe id="ifrMainWiseLogForm" name="ifrMainWiseLogForm" src="about:blank"  height="0" width="0" style="display:none;"></iframe>
</form>
}

@if (Model.IsFailLogin)
{
	<script type="text/javascript" language="javascript">
	    alert('로그인에 실패하였습니다.\n\n다시 확인 하신 후 로그인 하시기 바랍니다.');
	</script>
}
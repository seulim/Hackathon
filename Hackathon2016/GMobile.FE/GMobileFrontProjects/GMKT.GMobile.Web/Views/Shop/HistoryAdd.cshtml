@{
	Layout = null;
}

@using GMKT.GMobile.Web.Models
@using Newtonsoft.Json

@model HistoryAddM

<script type="text/javascript">
	var NUMBER_OF_HISTORY = 20;
	
	var alias = "@Model.Alias";

	if (window.localStorage) {
		var shopHistory = JSON.parse(window.localStorage.getItem("GMKTShopHistory"));

		if (shopHistory == null) {
			shopHistory = {};
		}
		
		var aliasHistory = shopHistory[alias];

		if (!aliasHistory) {
			aliasHistory = [];
		}

		var thisHistory = @Html.Raw(JsonConvert.SerializeObject(Model));

		if (aliasHistory.length <= 0 || thisHistory.Url != aliasHistory[aliasHistory.length - 1].Url) {
			aliasHistory.push(thisHistory);
		}
		
		if (aliasHistory.length > NUMBER_OF_HISTORY) {
			var howMany = aliasHistory.length - NUMBER_OF_HISTORY;
			aliasHistory.splice(0, howMany);
		}

		shopHistory[alias] = aliasHistory;

		window.localStorage.setItem("GMKTShopHistory", JSON.stringify(shopHistory));
	}
</script>
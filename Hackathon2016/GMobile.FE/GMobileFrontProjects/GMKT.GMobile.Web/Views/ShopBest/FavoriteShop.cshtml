@model GMKT.GMobile.Web.Models.FavoriteShopListModel
@using GMKT.GMobile.Data.ShopBest;

<div id="sb_container">
	@Html.Partial( "Shared/_ShopBestHeader", Model, new ViewDataDictionary { { "HasOnlyFavoriteShopButton", true }, { "HasBestGroup", true }, { "IsFavoriteShop", true }, { "MenuIndex", Request.QueryString["menuIndex"] } } )
	
	<div class="sb-body">

		<div class="sb-body__shop-list">
		@if(Model.ShopAndItems != null && Model.ShopAndItems.Count > 0)
		{ 
			@Html.Partial( "Shared/_ShopListTemplete", Model )
		}
		else
		{
			<div class="result_nodata">
				<p class="msg">등록하신 관심매장이 없습니다.</p>
				<span><a href="/ShopBest/BestShop" class="button--sbest button--back_list">신규샵 메인으로 이동</a></span>
			</div>
		}
		</div>

		<!-- 더보기 -->
		<div class="sb-brand_more-btn"><button type="button" class="button--more">더보기</button></div>
		<!-- //더보기 -->

		<!-- Overlay Dimmed layer -->
		<div class="dimOverlay" id="overlay"></div>
		<!-- //Overlay Dimmed layer -->

		<!-- 바로가기URL 레이어 -->
		<div class="ov_layer layer_copy_url" id="shortcut_url">
			<div class="layer_copy_url__txt">아래 바로가기 주소를 복사하여<br>다른 곳에 붙여 넣기 하실 수 있습니다.</div>
			<div class="layer_copy_url__box"><input type="url" value=""></div>
			<a href="#" class="ov_layer__close"><img src="@Urls.MobileImagePics/mobile/corner/shopbest/btn_layer_close.png" alt="닫기"></a>
		</div>
	</div>
</div>
<input type="hidden" id="hdnShopListPageNo" />
<input type="hidden" id="hdnShopList" />
<script type="text/javascript">
	var totalCount = @Model.TotalShopCount;
	var pageSize = @Model.PageSize;
	var pageNo = 1;
	var leftCount = totalCount - pageSize;

	$(function () {
		/* 플리킹 */
		$('.sb-shop-container').each(function () {
			$(this).slider();
		})
		/* 바로가기 URL 샘플 */
		$(document).on('click', '.sb-shop__share-shortcut, .sb-item__share-shortcut', function (e) {
			e.preventDefault();
			$('#overlay, #shortcut_url').addClass('opened');
			var url = $(this).prop('href');
			//$('#overlay, #shortcut_url').find('input')
			$('#overlay, #shortcut_url').find('input').val(url);
		}).on('click', '#overlay, .ov_layer__close', function (e) {
			e.preventDefault();
			$('#overlay, #shortcut_url').removeClass('opened');
		})
		$(window).on('resize', function () {
			$('#overlay, #shortcut_url').removeClass('opened');
		})

		$('#hdnShopListPageNo').val(pageNo);

		if(totalCount <= pageSize){
			$('.sb-brand_more-btn').hide();
		}
		else{
			$('.sb-brand_more-btn').bind('click', function(event){
				leftCount -= pageSize;
				pageNo++;
				$.ajax({
					type: "GET",
					url: "/ShopBest/GetShopList/",
					dataType: "json",
					data: {
						pageNo: pageNo
						, indicator: "favorite"
					},
					error: function (request, status, error) {

					},
					success: function (result) {
						if (result.data) {
							$('div.sb-body__shop-list').append(result.data);
							$('.sb-shop-container').each(function () {
								$(this).slider();
							});
							$('#hdnShopListPageNo').val(pageNo);
							$('#hdnShopList').val($('#hdnShopList').val() + result.data);
						}
					}
				});
				if(leftCount <= 0){
					$('.sb-brand_more-btn').hide();
				}
			});
		}
	});

	if($('#hdnShopList').val()){
		pageNo = Number($('#hdnShopListPageNo').val());
		leftCount -= pageSize * (pageNo - 1) ;
		$('div.sb-body__shop-list').append($('#hdnShopList').val());
		if(leftCount <= 0){
			$('.sb-brand_more-btn').hide();
		}
	}
</script>
<script type="text/javascript" src="@Urls.ScriptUrl/mobile/js/shopbest.js?v=1"></script>

